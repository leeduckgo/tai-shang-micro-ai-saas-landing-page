{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/conhecendo-boas-praticas-do-rspec/",
    "result": {"data":{"markdownRemark":{"html":"<p>Recentemente numa tech talk interna da squad conversamos sobre algumas boas pr√°ticas de escrita de testes automatizados com RSpec. Nesse post gostaria de levar esse conhecimento para outras pessoas tamb√©m.</p>\n<p>Antes gostaria de fazer dois disclaimers:</p>\n<ul>\n<li>N√£o sou especialista em testes e nem em Ruby/RSpec, apenas algu√©m que estudou algumas coisas e quer compartilhar com outras pessoas. Caso voc√™ n√£o concorde com algo aqui, tudo bem! Vou ficar bem contente se voc√™ comentar logo abaixo sobre e eu poder aprender com voc√™ :)</li>\n<li>Esse conte√∫do √© um 'compilado' de v√°rias fontes diferentes, vou deixar todas elas (e outras refer√™ncias) listadas l√° no final.</li>\n</ul>\n<p>Disclamer feito, bora l√°:</p>\n<h2>Porque usar boas pr√°ticas importa?</h2>\n<ul>\n<li>Documenta√ß√£o: ao escrever testes sem√¢nticos, que testam de verdade o comportamento que o usu√°rio tem com o sistema, indiretamente voc√™ acaba criando uma documenta√ß√£o do que aquela parte do c√≥digo faz e fica muito mais f√°cil de compreender a responsabilidade daquilo. Eu mesmo, ao pegar um c√≥digo que nunca vi antes, a primeira coisa √© ler os outputs dos testes para tentar entender o que ele faz.</li>\n<li>Ajuda no debug: muito relacionado com o t√≥pico anterior, ao debuggar n√≥s lemos <strong>muito</strong> c√≥digo e se eles (tanto o c√≥digo em si, como o teste) estiverem bem escritos facilitar√° bastante a busca para achar a causa raiz de um determinado problema.</li>\n<li>Facilita o onboarding de novas pessoas no time: se voc√™ usa um padr√£o que foi definido pela comunidade, n√£o ser√£o apenas as pessoas do seu time que conhecer√£o a forma ideal de escrever os testes, logo, aquela pessoa que acabou de entrar no time e que tamb√©m conhece as boas pr√°ticas se sente muito mais contextualizada.</li>\n<li>Padroniza a forma de escrever: o que refor√ßa o t√≥pico anterior e tamb√©m tira subjetividades na hora do <em>code review</em> evitando coment√°rios como \"faltou espa√ßos aqui e ali\" üôÑ</li>\n<li>‚ÄúDesign your code to be easier to understand, not easier to write‚Äù: esse √© um dos pr√≠ncipios de engenharia na Resultados Digitais (empresa que trabalho atualmente) e acho que ele fala por si s√≥.</li>\n</ul>\n<blockquote>\n<h4><em>Bora pro c√≥digo!</em></h4>\n</blockquote>\n<h2>1# described_class</h2>\n<p>Refira-se a classe testada como <code class=\"language-text\">described_class</code> e n√£o chamando-a diretamente, assim se alterar o nome da classe, n√£o altera o spec.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\nRSpec<span class=\"token punctuation\">.</span>describe MyClass <span class=\"token keyword\">do</span>\n  it <span class=\"token string-literal\"><span class=\"token string\">'test something'</span></span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># test here...</span>\n\n    MyClass<span class=\"token punctuation\">.</span>my_method\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\nRSpec<span class=\"token punctuation\">.</span>describe MyClass <span class=\"token keyword\">do</span>\n  it <span class=\"token string-literal\"><span class=\"token string\">'test something'</span></span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># test here...</span>\n\n    described_class<span class=\"token punctuation\">.</span>my_method\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2>2# contexts</h2>\n<p>Organiza e separa seus testes de acordo com o cen√°rio/contexto. Para saber quando usar pense que haver√° pelo menos 2 cen√°rios (positivo e negativo). No exemplo abaixo existe o cen√°rio de <em>logado</em> e <em>n√£o logado</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\nit <span class=\"token string-literal\"><span class=\"token string\">'has 200 status code if logged in'</span></span> <span class=\"token keyword\">do</span>\n  response<span class=\"token punctuation\">.</span>should respond_with <span class=\"token number\">200</span>\n<span class=\"token keyword\">end</span>\nit <span class=\"token string-literal\"><span class=\"token string\">'has 401 status code if not logged in'</span></span> <span class=\"token keyword\">do</span>\n  response<span class=\"token punctuation\">.</span>should respond_with <span class=\"token number\">401</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when logged in'</span></span> <span class=\"token keyword\">do</span>\n  it <span class=\"token punctuation\">{</span> is_expected<span class=\"token punctuation\">.</span>to respond_with <span class=\"token number\">200</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span>\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when logged out'</span></span> <span class=\"token keyword\">do</span>\n  it <span class=\"token punctuation\">{</span> is_expected<span class=\"token punctuation\">.</span>to respond_with <span class=\"token number\">401</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Uma dica extra aqui √©, ap√≥s escrever seus specs rode <code class=\"language-text\">rspec -f d</code> e o output deve ter uma leitura flu√≠da, como se fosse uma documenta√ß√£o realmente. Caso n√£o esteja assim, seja legal e reveja a descri√ß√£o dos seus <code class=\"language-text\">contexts</code> e <code class=\"language-text\">its</code> :)</p>\n<h2>3# describe</h2>\n<p>Use describes para deixar claro qual m√©todo da classe voc√™ est√° testando. Use <code class=\"language-text\">.</code> ou <code class=\"language-text\">::</code> (particularmente, prefiro a primeira op√ß√£o) para m√©todos de classe/est√°ticos e use <code class=\"language-text\">#</code> para m√©todos de inst√¢ncia.\nImagine que tenhamos a classe <code class=\"language-text\">User</code> com dois m√©todos: <code class=\"language-text\">admin?</code> e <code class=\"language-text\">authenticate</code> sendo que o segundo m√©todo √© est√°tico.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span>\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">admin</span></span><span class=\"token operator\">?</span>\n    <span class=\"token comment\">#...</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span></span>\n    <span class=\"token comment\">#...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Para o m√©todo <code class=\"language-text\">admin?</code> os specs ficariam:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\ndescribe <span class=\"token string-literal\"><span class=\"token string\">'if the user is an admin '</span></span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\">#...</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\ndescribe <span class=\"token string-literal\"><span class=\"token string\">'#admin?'</span></span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\">#...</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>E para o m√©todo est√°tico <code class=\"language-text\">authenticate</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\ndescribe <span class=\"token string-literal\"><span class=\"token string\">'the authenticate method for User'</span></span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\">#...</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\ndescribe <span class=\"token string-literal\"><span class=\"token string\">'.authenticate'</span></span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\">#...</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2>4# let</h2>\n<p>Use o <code class=\"language-text\">let</code> ao inv√©s de usar usar vari√°veis de inst√¢ncia. O <code class=\"language-text\">let</code> faz cache dos resultados e ele √© pregui√ßoso, ou seja, s√≥ vai ser declarado se realmente for chamado. J√° as vari√°veis de inst√¢ncia s√£o declaradas sempre, mesmo que n√£o usadas.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\nbefore <span class=\"token keyword\">do</span>\n  <span class=\"token variable\">@name</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">'Marcinho'</span></span>\n<span class=\"token keyword\">end</span>\n\nit <span class=\"token string-literal\"><span class=\"token string\">'reverses a name'</span></span> <span class=\"token keyword\">do</span>\n  expect<span class=\"token punctuation\">(</span>reverser<span class=\"token punctuation\">.</span>reverse <span class=\"token variable\">@name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">'ohnicraM'</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\nlet<span class=\"token punctuation\">(</span><span class=\"token symbol\">:name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal\"><span class=\"token string\">'Marcinho'</span></span> <span class=\"token punctuation\">}</span>\n\nit <span class=\"token string-literal\"><span class=\"token string\">'reverses a name'</span></span> <span class=\"token keyword\">do</span>\n  expect<span class=\"token punctuation\">(</span>reverser<span class=\"token punctuation\">.</span>reverse name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">'ohnicraM'</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Ainda sobre vari√°veis <code class=\"language-text\">let</code> √© interessante compartilha-l√°s entre grupos de testes para evitar ter que declarar a mesma coisa duas vezes, por exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when the user has many points'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">points</span><span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token string-literal\"><span class=\"token string\">'returns ok'</span></span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when the user has no points'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">points</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token string-literal\"><span class=\"token string\">'does not return ok'</span></span> <span class=\"token keyword\">do</span>\n      <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\nlet<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">points</span><span class=\"token operator\">:</span> points<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when the user has many points'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:points</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token string-literal\"><span class=\"token string\">'returns ok'</span></span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when the user has no points'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:points</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token string-literal\"><span class=\"token string\">'does not return ok'</span></span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><em>Obs: Esse <code class=\"language-text\">create</code> √© um m√©todo do Factory Bot, vamos falar sobre ele j√° j√°.</em></p>\n<p>Por fim, voc√™ tamb√©m pode usar o bang (<code class=\"language-text\">let!</code>) para tirar a pregui√ßa dele, ou seja, a vari√°vel ser√° declarada assim que o teste for executado. Esse cen√°rio pode ser √∫til quando voc√™ precisa ter garantia que algo foi escrito no banco antes de executar o assert.</p>\n<h2>5# subject</h2>\n<p>Se voc√™ tiver v√°rios testes relacionados ao mesmo assunto, use o <code class=\"language-text\">subject</code> e n√£o se repita v√°rias vezes.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when payload is nil'</span></span> <span class=\"token keyword\">do</span>\n  it <span class=\"token punctuation\">{</span> expect<span class=\"token punctuation\">(</span>described_class<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span><span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be_nil <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when payload is 100'</span></span> <span class=\"token keyword\">do</span>\n  it <span class=\"token punctuation\">{</span> expect<span class=\"token punctuation\">(</span>described_class<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\nsubject <span class=\"token punctuation\">{</span> described_class<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when payload is nil'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">nil</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token punctuation\">{</span> expect<span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be_nil <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when payload is 100'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token punctuation\">{</span> expect<span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Para ficar mais legal ainda voc√™ pode criar <em>named subjects.</em> Vamos melhorar um pouquinho esse c√≥digo acima:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">subject<span class=\"token punctuation\">(</span><span class=\"token symbol\">:created_payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> described_class<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when payload is nil'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">nil</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token punctuation\">{</span> expect<span class=\"token punctuation\">(</span>created_payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be_nil <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span>\n\ncontext <span class=\"token string-literal\"><span class=\"token string\">'when payload is 100'</span></span> <span class=\"token keyword\">do</span>\n  let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token punctuation\">{</span> expect<span class=\"token punctuation\">(</span>created_payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2>6# shared_examples</h2>\n<p>Quando voc√™ repara que est√° ficando com muito c√≥digo duplicado no seu teste, voc√™ pode recorrer ao <code class=\"language-text\">shared_examples</code>. Se voc√™ tiver um arquivo de teste muito grande, particularmente, te sugiro aplic√°-lo dentro de um mesmo contexto para voc√™ n√£o se perder com v√°rios exemplos compartilhados no arquivo.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">describe <span class=\"token string-literal\"><span class=\"token string\">'GET .some_route'</span></span> <span class=\"token keyword\">do</span>\n  subject<span class=\"token punctuation\">(</span><span class=\"token symbol\">:action</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n    get <span class=\"token symbol\">:some_route</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">params</span><span class=\"token operator\">:</span> params\n  <span class=\"token keyword\">end</span>\n\n  shared_examples <span class=\"token string-literal\"><span class=\"token string\">'response success'</span></span> <span class=\"token keyword\">do</span>\n    it <span class=\"token string-literal\"><span class=\"token string\">'returns status 200'</span></span> <span class=\"token keyword\">do</span>\n      action\n\n      expect<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq <span class=\"token number\">200</span>\n    <span class=\"token keyword\">end</span>\n\n    it <span class=\"token string-literal\"><span class=\"token string\">'returns response body'</span></span> <span class=\"token keyword\">do</span>\n      action\n\n      expect<span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq expected_json\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n\n  context <span class=\"token string-literal\"><span class=\"token string\">'when all things works are correctly'</span></span> <span class=\"token keyword\">do</span>\n    let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:params</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token string-literal\"><span class=\"token string\">'id'</span></span> <span class=\"token operator\">=></span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">end</span>\n\n    let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:expected_json</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token symbol\">hello</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'world of 1'</span></span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">end</span>\n\n    it_behaves_like <span class=\"token string-literal\"><span class=\"token string\">'response success'</span></span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Se ligou que aqui usei v√°rias coisas que ja comentamos aqui antes? üòâ</p>\n<h2>7# FactoryBot</h2>\n<p>O FactoryBot cria <em>fixtures</em> de teste que s√£o objetos de teste falsos que podem ser reutilizados durante o teste. Imagine que em N lugares dos testes da sua aplica√ß√£o voc√™ precisa ter um objeto do usu√°rio. Ao inv√©s de voc√™ declarar ele \"na m√£o\" em cada lugar desse, voc√™ apenas chama a Factory que faz isso pra voc√™.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\nlet<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n  User<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>\n    <span class=\"token symbol\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token symbol\">name</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'Fulano'</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token symbol\">last_name</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'Silva'</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token symbol\">city</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'Florian√≥polis'</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token symbol\">address</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'Rua Logo Ali, 123'</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token symbol\">active</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\nlet<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> FactoryBot<span class=\"token punctuation\">.</span>create <span class=\"token symbol\">:default_user</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Caso voc√™ precise mudar algum valor que est√° definido l√° na Factory, basta passar junto ap√≥s chamar a cria√ß√£o:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> FactoryBot<span class=\"token punctuation\">.</span>create <span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">city</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'S√£o Paulo'</span></span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">active</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<h2>8# build_stubbed</h2>\n<p>√â um m√©todo do FactoryBot que n√£o persiste o dado no banco, apenas te d√° um objeto do que foi solicitado. Isso traz pequenas melhorias de performance, ent√£o, se voc√™ tiver uma pipeline de testes muito grande, isso pode te salvar alguns segundos :)</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ‚ùå</span>\nlet<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> FactoryBoy<span class=\"token punctuation\">.</span>create <span class=\"token symbol\">:default_user</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># ‚úÖ</span>\nlet<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> FactoryBot<span class=\"token punctuation\">.</span>build_stubbed <span class=\"token symbol\">:default_user</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<h2>9# SimpleCov</h2>\n<p>√â um analisador de coverage para Ruby. Acho ele bem interessante porque te mostra exatamente qual parte do c√≥digo n√£o est√° coberto e voc√™ pode ir l√° e consertar isso. Saiba mais sobre ele <a href=\"https://github.com/simplecov-ruby/simplecov\">aqui</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdElEQVQoz0WQbW+aUBiG+3v3Zda4tV22xv/QpJ+a7MviEnWrTK0C54BALeeAL4gvA7QchEbbWd+wim5tXdQm3s/z9cp1P89Bms4mLpNx6kcinjiOnnzPxSlIUVz6l3R1WcikxGyqkKXEq5SQ+ZaMpVKp+M/E2dnZ+fl5NBo9EARRwsWCLOby+XdfQnmvIJm88IALj6XiSFMmujyu3Ux15aUNNUlFSqVS0WpavV6nKOoAAMBzm6EZ5uNRuFa/viV1x2063YbnNj235bktt9u86xmtRgVCyPM8AEAUxVgsdsCyLAuALMvFYvEo8sEx26vZUzCZBhN/MfbnY38xns5Hk+V01nM9jLGqKKqqapqWSCQ2ZoZhBEEQBTFyFNGtqtMnnb7tDN3u0HU363mju75/3zCbSEayLCOEKpXKHuYg5EQxenh4l6YGgJ+w0gDyDxA8Frg5Ly2vb15LSg9jpKgIIYxxtVrdwwWezzHM53C4L0mTmr5oNp9Na2UYS8NYGebqt/FiWT1dlzFG2+zNPM9Logh5/ksk0lPVQaMxbLV801x0OivbXtp2YNv/CPnTtjbSbfbmHZ/OZE7C4X6pNDVM37Tm9m1g20tCloQEhPx1nEGnI6M3vFwub2CWZWma5jmOhvA0FBrk82NBmMlygPEcoc3KKMB4XS4Pt7V3easNIdzdLEjS6fGxp1WnxHmyHZ8Q33F8x5l1u0+uu/S8B9tG25v3tXdmhqZzDPPpfeheECZVLWi01oSsu901Ia/t9nO7ve50RpYlb7+1N3McBwCAEAIAvl5clNFNray2ShWYyWSTSZjNmlrN0nVL15uapqiqss3O/B+1QGMgtNxApAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"Report de cobertura de teste do SimpleCov\"\n        title=\"Report de cobertura de teste do SimpleCov\"\n        data-src=\"/static/5fa00b0ee301c2a05e05de6e3fdccc96/1cfc2/simple-cov.png\"\n        data-srcset=\"/static/5fa00b0ee301c2a05e05de6e3fdccc96/3684f/simple-cov.png 225w,\n/static/5fa00b0ee301c2a05e05de6e3fdccc96/fc2a6/simple-cov.png 450w,\n/static/5fa00b0ee301c2a05e05de6e3fdccc96/1cfc2/simple-cov.png 900w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Bom, eras isso! N√£o √© nada muito complexo, mas com certeza pode te ajudar no dia a dia lidando com Ruby e RSpec.</p>\n<p>Caso tenha encontrado algum erro, <a href=\"https://github.com/kaiofelipejs/kaiofelipejs.dev\">esse blog √© open source</a>, basta editar o arquivo de texto desse post l√° no github e mandar um PR, simples assim! :)</p>\n<h4>Fontes e refer√™ncias</h4>\n<ul>\n<li><a href=\"https://rspec.rubystyle.guide/\">The RSpec Style Guide</a></li>\n<li><a href=\"http://www.betterspecs.org\">Better Specs { rspec guidelines with ruby }</a></li>\n<li><a href=\"https://docs.rubocop.org/rubocop-rspec/cops_rspec.html\">RuboCop RSpec - Docs</a></li>\n<li><a href=\"https://www.youtube.com/watch?reload=9&#x26;v=cHAnlE3kwBM\">Escrevendo testes melhores com Rspec - Ruby - Por Heitor Miranda - 30¬∫ GURU-CE</a></li>\n</ul>","fields":{"slug":"/conhecendo-boas-praticas-do-rspec/"},"frontmatter":{"date":"05 de outubro de 2020","description":"Porque isso importa e como essas pr√°ticas podem ajudar no dia a dia.","title":"Conhecendo boas pr√°ticas do RSpec","image":"/assets/img/praticas-rspec.png"},"timeToRead":7}},"pageContext":{"slug":"/conhecendo-boas-praticas-do-rspec/","previousPost":{"frontmatter":{"title":"Seja ‚Äúpregui√ßoso‚Äù e fa√ßa diferente"},"fields":{"slug":"/seja-preguicoso-e-faca-diferente/"}},"nextPost":{"fields":{"slug":"/transicao-de-carreira-minha-jornada-ate-se-tornar-um-desenvolvedor-de-software/"},"frontmatter":{"title":"Transi√ß√£o de carreira: minha jornada at√© me tornar um desenvolvedor de software"}}}},
    "staticQueryHashes": ["1244830069","764694655"]}