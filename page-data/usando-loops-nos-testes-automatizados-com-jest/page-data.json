{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/usando-loops-nos-testes-automatizados-com-jest/",
    "result": {"data":{"markdownRemark":{"html":"<p>Algumas vezes já precisei escrever testes automatizados que eram muito semelhantes, pois só mudavam o argumento/retorno e eu acabava duplicando código escrevendo cada cenário de teste \"na mão\". Não quero que você sofra com isso também, então, neste post pretendo mostrar como podemos escrever nossos cenários de testes de forma mais dinâmica com Jest usando a função <code class=\"language-text\">.each</code>.</p>\n<blockquote>\n<p>Vamos criar aqui uma situação simples para focarmos apenas no problema, que é a duplicação de código nos cenários de testes.</p>\n</blockquote>\n<p>Temos aqui o arquivo <code class=\"language-text\">bestThing.js</code> com a seguinte estrutura:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> bests <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">team</span><span class=\"token operator\">:</span> <span class=\"token string\">'palmeiras'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">fruit</span><span class=\"token operator\">:</span> <span class=\"token string\">'banana'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">band</span><span class=\"token operator\">:</span> <span class=\"token string\">'projeto sola'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">movie</span><span class=\"token operator\">:</span> <span class=\"token string\">'tarzan (1999)'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getBestThing</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">thing</span> <span class=\"token operator\">=></span> bests<span class=\"token punctuation\">[</span>thing<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> getBestThing<span class=\"token punctuation\">,</span> bests <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nada demais. Apenas um objeto com 4 itens e uma função que recebe uma chave e retorna o valor correspondente a essa chave do objeto. De boa.</p>\n<p>Agora, será preciso criar o arquivo de teste desse cara e construiremos três caminhos para testar essa função <code class=\"language-text\">getBestThing</code>. Bora lá:</p>\n<h2>Pior caminho, duplicando código:</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getBestThing <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'bestThing'</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'the worst'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when given thing is \"team\" should return \"palmeiras\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getBestThing</span><span class=\"token punctuation\">(</span><span class=\"token string\">'team'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'palmeiras'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when given thing is \"fruit\" should return \"banana\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getBestThing</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fruit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'banana'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when given thing is \"band\" should return \"projeto sola\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getBestThing</span><span class=\"token punctuation\">(</span><span class=\"token string\">'band'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'projeto sola'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when given thing is \"movie\" should return \"tarzan (1999)\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getBestThing</span><span class=\"token punctuation\">(</span><span class=\"token string\">'movie'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tarzan (1999)'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Sim, funciona. Mas consegue reparar como isso pode ser improdutivo se precisar alterar algo dessa expectativa final? Para evitar esse retrabalho no futuro, vamos refatorá-lo e criar um loop \"na mão\":</p>\n<h2>O caminho mais ou menos, criando loop \"na mão\"</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getBestThing<span class=\"token punctuation\">,</span> bests <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'bestThing'</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'the so-so'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>bests<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">thing</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">when given thing is \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>thing<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" should return \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>thing<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getBestThing</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>thing<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>thing<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Repare que agora tivemos que importar também o objeto <code class=\"language-text\">bests</code> para construir o teste dessa forma. É verdade que essa solução já é melhor que a anterior, mas você não acha um tanto ilegível? Pois é, eu também.</p>\n<p>Vamos, então, para a solução que eu considero mais elegante usando a função <code class=\"language-text\">.each</code> do próprio Jest que foi criada especialmente para esses cenários:</p>\n<h2>Caminho feliz, usando .each</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getBestThing <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'bestThing'</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'the good'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">'team'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'palmeiras'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">'fruit'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'banana'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">'band'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'projeto sola'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">'movie'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tarzan (1999)'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when given thing is \"%s\" should return \"%s\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">thing<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getBestThing</span><span class=\"token punctuation\">(</span>thing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Para entendermos melhor o que está rolando aqui, removeremos os valores e olharemos para a estrutura da função que fica assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">test<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">table</code>: é um Array de Arrays (uma Lista de Listas) que possui os argumentos que serão passados para a <code class=\"language-text\">fn</code> (função).</p>\n<p><code class=\"language-text\">name</code>: é uma String, o nome do seu bloco de teste. Aqui tem algo que acho muito bacana que é possível gerar nomes únicos para cada bloco injetando paramêtros neles. Reparou que ali no nome existem dois <code class=\"language-text\">%s</code>?! O <code class=\"language-text\">%s</code> retorna como String o conteúdo que está no indice atual. Ou seja, quando estiver na primeira linha da tabela, o nome do bloco do teste será <em>'when given thing is \"team\" should return \"palmeiras\"'</em> e assim para todos os demais alterando apenas esses valores. Existem outros parâmetros que podem ser usados e estão <a href=\"https://jestjs.io/docs/en/api#1-testeachtablename-fn-timeout\">listados na documentação</a>.</p>\n<p><code class=\"language-text\">fn</code>: é o teste a ser executado. É a função que receberá por argumento o que está em cada linha da tabela.</p>\n<p>Fazendo dessa forma, evitamos duplicar código e o mantemos limpo! 🎉</p>\n<p>No fim, o output final do teste será o mesmo, mas pode ter certeza que o seu \"eu do futuro\" agradecerá por encontrar um lugar mais organizado.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 606px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQoz4WRS27DMAxEc5u4tmWKIvWXpThBWhTZ9AZd9f5XKCi7SLsqMBAgCg8zHJ0en68fXw/Ol1DuZXtP9c3lG7o6zPyvTjN6itWmq6aymKR5nXUAyrsWkxaTlcwLcJnAK4wvyh7weaQRLNrVuGZsJX8BynLtE3LNuKq5ULgY3zQXhfHpPIHnuPl8Q7sqDIvJsw4KY1fqin2S9smswxMeFC+UOGzGN7Qr+QYk4dFWdBVt1fZwlieTJ/B/YOBk49U4gY3ETh3rvMArUDauaV735OeJDngEx2mL6x0oK4wSG3pIqUrOfYWF8m6rMP0qbKIZnXGVvHRDYZPCXKW9Ld/QiTnHjXxbjOz8hIeZJ/D9Y+SrgEr3Tz/Ku7mkwARcVOdH8MNE30DlbXBPlp01AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"Output dos testes nos três caminhos\"\n        title=\"Output dos testes nos três caminhos\"\n        data-src=\"/static/6864ef3dab1a5e15a7708ddb133d4c08/4d4a2/output-tests-loop.png\"\n        data-srcset=\"/static/6864ef3dab1a5e15a7708ddb133d4c08/3684f/output-tests-loop.png 225w,\n/static/6864ef3dab1a5e15a7708ddb133d4c08/fc2a6/output-tests-loop.png 450w,\n/static/6864ef3dab1a5e15a7708ddb133d4c08/4d4a2/output-tests-loop.png 606w\"\n        sizes=\"(max-width: 606px) 100vw, 606px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p><strong>...</strong></p>\n</blockquote>\n<p>O exemplo para ilustrar o uso dos loops foi simples, mas imagine que isso poderia ser algo mais complexo como fazer requisição para uma API, mostrar uma quantidade X de itens na tela quando algo Y estiver acontecendo e por aí vai...</p>\n<p>Espero que essa dica tenha sido útil e fique super a vontade para compartilhar outras coisas aqui nos comentários. Bora aprender juntos! 😄</p>\n<p>Até a próxima!</p>\n<h3>Referências</h3>\n<ul>\n<li><a href=\"https://jestjs.io/docs/en/api\">Documentação do Jest</a></li>\n<li><a href=\"https://www.udemy.com/course/react-redux-profissional/\">Curso React Profissional - Nardiny Academy</a></li>\n</ul>","fields":{"slug":"/usando-loops-nos-testes-automatizados-com-jest/"},"frontmatter":{"date":"15 de janeiro de 2021","description":"Nesse post quero mostrar como podemos evitar a duplicação de código e mantê-lo legível usando a função .each do Jest para testar cenários semelhantes.","title":"Testes automatizados: validando cenários sem duplicar código com Jest","image":"/assets/img/tests-loops-jest.png"},"timeToRead":3}},"pageContext":{"slug":"/usando-loops-nos-testes-automatizados-com-jest/","previousPost":{"frontmatter":{"title":"Transição de carreira: minha jornada até me tornar um desenvolvedor de software"},"fields":{"slug":"/transicao-de-carreira-minha-jornada-ate-se-tornar-um-desenvolvedor-de-software/"}},"nextPost":{"fields":{"slug":"/sempre-temos-algo-a-compartilhar/"},"frontmatter":{"title":"Sempre temos algo a compartilhar"}}}},
    "staticQueryHashes": ["1244830069","764694655"]}